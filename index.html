<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="apple-touch-icon" href="launch.png">
  <link rel="apple-touch-startup-image" href="launch.png">
  <meta name="apple-mobile-web-app-title" content="Korero">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <script type="text/javascript" src="unmute.js"></script>

</head>

<body>
  <audio id="steam" src="steam.mp3" preload="auto"></audio>
  <audio id="seagull" src="seagull.mp3"></audio>
  <audio id="Cats" src="Cats.mp3"></audio>
  <audio id="Chickens" src="Chickens.mp3"></audio>

  <button id="start" class="button">start</button><br>
  <button id="play" class="button">play</button><br>
  <br>
  <div id="output"></div>


  <script>
    //  var audioCtx;
    var tracks;
    var steamSound;
    var seagullSound;
    var CatsSound;
    var ChickensSound;

    var started = false;
    output = document.getElementById("output");

    start = () => {
      //  document.getElementById("seagull").muted=false;
      //  document.getElementById("seagull").play();
      if (started == false) {
        //    alert("started");

        started = true;
        audioCtx = new(window.AudioContext || window.webkitAudioContext)();
        //  audioCtx = new AudioContext || window.webkitAudioContext;


        steamSound = new Sound("steam");
        seagullSound = new Sound("seagull");
        CatsSound = new Sound("Cats");
        ChickensSound = new Sound("Chickens");
        /*
document.getElementById("steam").play();
document.getElementById("Cats").play();
document.getElementById("Chickens").play();
document.getElementById("seagull").play();
*/

        tracks = [
          //  new Track(1, CatsSound, 1),
          //  new Track(6, ChickensSound, 1),
          new Track(1, steamSound, 3) ,
              new Track(6, steamSound, 5) //,
          //  new Track(25, seagullSound, 2)
        ]

        /*  for (let i = 0; i < tracks.length; i++) {
          setTimeout(function() {
            tracks[i].play();
             output.innerHTML = (tracks[i].time + "  " + tracks[i].soundName.fileName);
          }, tracks[i].time * 1000);
        }
*/
      }
    }

    playTracks = () => {
      for (let i = 0; i < tracks.length; i++) {
        setTimeout(function() {
          tracks[i].play();
          output.innerHTML = (tracks[i].time + "  " + tracks[i].soundName.fileName);
        }, tracks[i].time * 1000);
      }

    }

    class Sound {
      constructor(soundName) {
        this.soundName = soundName;
        this.fileName = this.soundName + ".mp3";
        this.audioElement = document.getElementById(soundName);
        this.audioElement.play();
        this.track = audioCtx.createMediaElementSource(this.audioElement);
        this.gainNode = audioCtx.createGain();
        this.gainNode.gain.value = 1;
        //  gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
        this.panner = audioCtx.createStereoPanner();

      }

      pannerList=[[0,0,5],[-1,0,5],[0,1,5],[1,0,5],[0,-1,5]];

      panner(pannerNumber) {
        start=pannerList[pannerNumber][0];
          end=pannerList[pannerNumber][1];
            time=pannerList[pannerNumber][2];
        this.panner.pan.setValueAtTime(start, audioCtx.currentTime);
        this.panner.pan.linearRampToValueAtTime(end, audioCtx.currentTime + time);

      }

      play(panValue) {
        this.track.connect(this.gainNode).connect(this.panner).connect(audioCtx.destination);
        this.audioElement.play();
        panner(panValue);
        //this.gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 2);
    //    this.panner.pan.setValueAtTime(1, audioCtx.currentTime);
    //    this.panner.pan.linearRampToValueAtTime(-1, audioCtx.currentTime + 6);

      }
    }

    class Track {
      constructor(time, soundName, panValue) {
        this.time = time;
        this.soundName = soundName;
        this.panValue = panValue;
      }
      play() {
        this.soundName.play(panValue);
      }
    }

    document.getElementById("start").addEventListener("click", () => {
      start();
    });

    document.getElementById("play").addEventListener("click", () => {
      playTracks();
    });
  </script>

  <br><br> v84
</body>

</html>
